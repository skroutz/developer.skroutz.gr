#!/bin/bash

set -e

declare -A domains
domains[alve]=alve.com
domains[skroutz]=skroutz.gr
domains[scrooge]=scrooge.co.uk

tmp_path=./build
deploy_to=/var/sites/developer.${domains[$FLAVOR]}
deploy_user=wowbagger
deploy_server=developer.skroutz.gr

#Check for rsync
type rsync >/dev/null || echo "apt-get install rsync"

bundle exec middleman build

echo -e "\n ==> Deploying ${FLAVOR} to $deploy_user@$deploy_server\n"
rsync -e ssh -avz --delete $tmp_path/ $deploy_user@$deploy_server:$deploy_to
ssh $deploy_user@$deploy_server 'rm -vrf /var/sites/developer.${domains[$FLAVOR]}/responses'
